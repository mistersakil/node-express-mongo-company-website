<%- include("../layout/header") %>
<div class="row">
    <div class="col-md-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <%- include("../partials/top-link") %>
                <!-- Filter Form -->
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Filter User
                            <%- formData.name ? `<span class="text-primary">by name = ${formData.name}</span>` : `` %>
                            <%- formData.mobile ? `<span class="text-success">by mobile = ${formData.mobile}</span>` : `` %>
                            <%- formData.email ? `<span class="text-danger">by email = ${formData.email}</span>` : `` %>
                            <% if(formData.userType){
                                userTypeName = ``;
                                userTypes.forEach(userType =>{
                                   if(userType.value == formData.userType){
                                    userTypeName =  userType.label ;
                                   }
                                })
                            %>
                            <%- `<span class="text-dark">by User Type = ${userTypeName}</span>` %>
                            <% } %>
                        </h4>
                        <form class="form-inline" method="get" action="<%=links.read%>">
                            <input type="text" class="form-control mb-2 mr-sm-2" placeholder="Name" name="name" value="<%= formData.name ? formData.name.trim() : null %>" />
                            <input type="text" class="form-control mb-2 mr-sm-2" placeholder="Mobile" name="mobile" value="<%= formData.mobile ? formData.mobile.trim() : null %>" />
                            <input type="text" class="form-control mb-2 mr-sm-2" placeholder="Email" name="email" value="<%= formData.email ? formData.email.trim() : null %>" />
                            <select class="form-control mb-2 mr-sm-2" name="userType">
                                <% userTypes.forEach(userType =>{ %>
                                <option value="<%= userType.value %>" <%=userType.value==formData.userType ? `selected` : ``%> >
                                    <%= userType.label%>
                                </option>
                                <% }) %>
                            </select>
                            <select class="form-control mb-2 mr-sm-2" name="perPage">
                                <% perPageItems.forEach(perPage =>{ %>
                                <option value="<%= perPage.value %>" <%=perPage.value==formData.perPage ? `selected` : ``%> >
                                    <%= perPage.label%>
                                </option>
                                <% }) %>
                            </select>
                            <button type="submit" class="btn btn-dark mb-2 mr-sm-2"><i class="fa fa-filter"></i> Filter</button>
                            <a href="/admin/users" class="btn btn-secondary mb-2 mr-sm-2"><i class="fa fa-refresh"></i> Reset</a>
                        </form>
                    </div>
                </div>
                <!-- Filter Form End -->
                <!-- List Display -->
                <div class="table-responsive">
                    <table id="order-listing" class="table table-striped table-bordered table-condensed">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Mobile</th>
                                <th>Email</th>
                                <th>Created At</th>
                                <th>Verified</th>
                                <th>Type</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if(models.length) {  %>
                            <% models.forEach(model => {  %>
                            <tr>
                                <td>
                                    <%=model.name%>
                                </td>
                                <td>
                                    <%=model.mobile%>
                                </td>
                                <td>
                                    <%=model.email%>
                                </td>
                                <td>
                                    <%=dateFormat(model.updatedAt)%>
                                </td>
                                <td>
                                    <% if(model.verifiedAt !== null){ %>
                                    <div class="badge badge-outline-info badge-pill">
                                        <%=dateFormat(model.verifiedAt,3)%>
                                    </div>
                                    <% }else{ %>
                                    <div class="badge badge-outline-secondary badge-pill">
                                        Pending
                                    </div>
                                    <% } %>
                                </td>
                                <td>
                                    <% if(model.userType ==1){ %>
                                    User
                                    <% }else if(model.userType >= 9){ %>
                                    Admin
                                    <% }else if(model.userType == 8){ %>
                                    Manager
                                    <% }else if(model.userType == 7){ %>
                                    Author
                                    <% }else if(model.userType == 6){ %>
                                    Editor
                                    <% }else{ %>
                                    Undefined
                                    <% } %>
                                </td>
                                <td class="text-center">
                                    <a href="<%=links.updateSingle(model._id)%>" class="btn-warning">
                                        <i class="fa fa-pencil"></i>
                                    </a>
                                    <a href="<%=links.readSingle(model._id)%>" class="btn-primary">
                                        <i class="fa fa-eye"></i>
                                    </a>
                                    <a onclick="return confirm(`Are you sure to delete this?`)" href="<%=links.deleteSingle(model._id)%>" class="btn-danger">
                                        <i class="fa fa-trash"></i>
                                    </a>
                                </td>
                            </tr>
                            <% }) %>
                            <% }else{ %>
                            <tr>
                                <td colspan="7">
                                    <h5>Nothing Found</h5>
                                </td>
                            </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
                <nav>
                    <p class="mt-20 text-secondary text-center">
                        <%= pagination.nowShowing %>
                    </p>
                    <ul class="pagination pagination-right flex-wrap justify-content-center pagination-secondary">
                        <% if(pagination.first) { %>
                        <li class="page-item">
                            <a class="page-link readonly" href="<%= `/admin/users?page=${pagination.first}` %><%= pagination.queryString ? `&`+pagination.queryString : `` %>" title="First">
                                First
                            </a>
                        </li>
                        <% } %>
                        <% if(pagination.currentPage > 1) { %>
                        <li class="page-item">
                            <a class="page-link readonly" href="<%= `/admin/users?page=${pagination.currentPage-1}` %><%= pagination.queryString ? `&`+pagination.queryString : `` %>" title="Previous">
                                <i class="ti-angle-left"></i>
                            </a>
                        </li>
                        <% } %>
                        <% pagination.links.forEach(pageNumber => { %>
                        <li class="page-item <%= pageNumber == pagination.currentPage ? `active` : `` %> "><a class="page-link readonly" href="<%= `/admin/users?page=${pageNumber}` %><%= pagination.queryString ? `&`+pagination.queryString : `` %>">
                                <%= pageNumber %></a></li>
                        <% }) %>
                        <% if(pagination.currentPage < pagination.totalPages) { %>
                        <li class="page-item">
                            <a class="page-link readonly" href="<%= `/admin/users?page=${pagination.currentPage+1}` %><%= pagination.queryString ? `&`+pagination.queryString : `` %>" title="Next">
                                <i class="ti-angle-right"></i>
                            </a>
                        </li>
                        <% } %>
                        <% if(!pagination.queryString){ %>
                        <li class="page-item">
                            <form action="<%=links.read%>" method="get">
                                <input name="page" type="text" class="paginationForm" title="Page Number" placeholder="Page" />
                            </form>
                        </li>
                        <% } %>
                        <% if(pagination.last) { %>
                        <li class="page-item">
                            <a class="page-link readonly" href="<%= `/admin/users?page=${pagination.last}` %><%= pagination.queryString ? `&`+pagination.queryString : `` %>" title="Last">
                                Last
                            </a>
                        </li>
                        <% } %>
                    </ul>
                </nav>
                <!-- List Display End-->
            </div>
        </div>
    </div>
</div>
<button type="button" class="btn btn-outline-primary btn-sm" onclick="showToastPosition('top-right')">Top-right</button>
<%- include("../layout/footer") %>
<!-- Plugin js for this page-->
<% if(1){ %>
<script src="/backend/js/jquery.toast.min.js"></script>
<script src="/backend/js/toastDemo.js"></script>
<% } %>
<!-- <script src="/backend/js/desktop-notification.js"></script> -->
<%- include("../layout/close") %>
